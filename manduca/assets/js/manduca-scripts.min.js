/*  This file is part of WordPress theme named Manduca - focus on accessibility.
 *
	Copyright (C) 2015-2022 Zsolt Edel√©nyi (ezs@web25.hu)

    Manduca is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    in /assets/docs/licence.txt.  If not, see <https://www.gnu.org/licenses/>.
*/
jQuery.noConflict(),document.getElementById("page").setAttribute("style","display:none");var OFFSET_PX=0,MIN_WIDTH=12,MIN_HEIGHT=8,START_FRACTION=.4,MIDDLE_FRACTION=.8,focusSnail={enabled:!0,trigger:trigger};function trigger(e,t){svg?onEnd():initialize();var a=dimensionsOf(e),o=dimensionsOf(t),n=0,i=0,l=0,s=0,r=animationDuration(dist(a.left,a.top,o.left,o.top));var d=!0;animate((function(e){d&&(!function setup(){var e=scrollOffset();svg.style.left=e.left+"px",svg.style.top=e.top+"px",svg.setAttribute("width",win.innerWidth),svg.setAttribute("height",win.innerHeight),svg.classList.add("focus-snail_visible"),n=o.left-e.left,i=a.left-e.left,l=o.top-e.top,s=a.top-e.top}(),setGradientAngle(gradient,i,s,a.width,a.height,n,l,o.width,o.height),enclose(getPointsList({top:s,right:i+a.width,bottom:s+a.height,left:i},{top:l,right:n+o.width,bottom:l+o.height,left:n}),polygon));var t=e>START_FRACTION?easeOutQuad((e-START_FRACTION)/(1-START_FRACTION)):0,r=e<MIDDLE_FRACTION?easeOutQuad(e/MIDDLE_FRACTION):1;start.setAttribute("offset",100*t+"%"),middle.setAttribute("offset",100*r+"%"),e>=1&&onEnd(),d=!1}),r)}function animationDuration(e){return 50*Math.pow(constrain(e,32,1024),1/3)}function easeOutQuad(e){return 2*e-e*e}var win=window,doc=document,docElement=doc.documentElement,body=doc.body,prevFocused=null,animationId=0,keyDownTime=0;function setGradientAngle(e,t,a,o,n,i,l,s,r){var d=rectCentroid(t,a,o,n),c=rectCentroid(i,l,s,r),u=angleToLine(Math.atan2(d.y-c.y,d.x-c.x));e.setAttribute("x1",u.x1),e.setAttribute("y1",u.y1),e.setAttribute("x2",u.x2),e.setAttribute("y2",u.y2)}function rectCentroid(e,t,a,o){return{x:e+a/2,y:t+o/2}}function angleToLine(e){var t=Math.floor(e/Math.PI*2)+2,a=Math.PI/4+Math.PI/2*t,o=Math.sqrt(2),n=Math.cos(Math.abs(a-e))*o,i=n*Math.cos(e),l=n*Math.sin(e);return{x1:i<0?1:0,y1:l<0?1:0,x2:i>=0?i:i+1,y2:l>=0?l:l+1}}docElement.addEventListener("keydown",(function(e){if(focusSnail.enabled){var t=e.which;(9===t||t>36&&t<41)&&(keyDownTime=Date.now())}}),!1),docElement.addEventListener("blur",(function(e){focusSnail.enabled&&(onEnd(),prevFocused=isJustPressed()?e.target:null)}),!0),docElement.addEventListener("focus",(function(e){prevFocused&&isJustPressed()&&trigger(prevFocused,e.target)}),!0);var svg=null,polygon=null,start=null,middle=null,end=null,gradient=null;function htmlFragment(){var e=doc.createElement("div");return e.innerHTML='<svg id="focus-snail_svg" width="1000" height="800">\t\t<linearGradient id="focus-snail_gradient">\t\t\t<stop id="focus-snail_start" offset="0%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0"/>\t\t\t<stop id="focus-snail_middle" offset="80%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0.8"/>\t\t\t<stop id="focus-snail_end" offset="100%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0"/>\t\t</linearGradient>\t\t<polygon id="focus-snail_polygon" fill="url(#focus-snail_gradient)"/>\t</svg>',e}function initialize(){var e=htmlFragment();svg=getId(e,"svg"),polygon=getId(e,"polygon"),start=getId(e,"start"),middle=getId(e,"middle"),end=getId(e,"end"),gradient=getId(e,"gradient"),body.appendChild(svg)}function getId(e,t){return e.querySelector("#focus-snail_"+t)}function onEnd(){animationId&&(cancelAnimationFrame(animationId),animationId=0,svg.classList.remove("focus-snail_visible"))}function isJustPressed(){return Date.now()-keyDownTime<42}function animate(e,t){var a=Date.now();!function loop(){animationId=requestAnimationFrame((function(){var o=Date.now()-a;e(o/t),o<t&&loop()}))}()}function getPointsList(e,t){var a=0;e.top<t.top&&(a=1),e.right>t.right&&(a+=2),e.bottom>t.bottom&&(a+=4),e.left<t.left&&(a+=8);for(var o=rectPoints(e).concat(rectPoints(t)),n=[],i=[[],[0,1],[1,2],[0,1,2],[2,3],[0,1],[1,2,3],[0,1,2,3],[3,0],[3,0,1],[3,0],[3,0,1,2],[2,3,0],[2,3,0,1],[1,2,3,0],[0,1,2,3,0]][a],l=0;l<i.length;l++)n.push(o[i[l]]);for(;l--;)n.push(o[i[l]+4]);return n}function enclose(e,t){t.points.clear();for(var a=0;a<e.length;a++){addPoint(t,e[a])}}function addPoint(e,t){var a=e.ownerSVGElement.createSVGPoint();a.x=t.x,a.y=t.y,e.points.appendItem(a)}function rectPoints(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom},{x:e.left,y:e.bottom}]}function dimensionsOf(e){var t=offsetOf(e);return{left:t.left-OFFSET_PX,top:t.top-OFFSET_PX,width:Math.max(MIN_WIDTH,e.offsetWidth)+2*OFFSET_PX,height:Math.max(MIN_HEIGHT,e.offsetHeight)+2*OFFSET_PX}}function offsetOf(e){var t=e.getBoundingClientRect(),a=scrollOffset(),o=docElement.clientTop||body.clientTop,n=docElement.clientLeft||body.clientLeft;return{top:t.top+a.top-o||0,left:t.left+a.left-n||0}}function scrollOffset(){return{top:win.pageYOffset||docElement.scrollTop||0,left:win.pageXOffset||docElement.scrollLeft||0}}function dist(e,t,a,o){var n=e-a,i=t-o;return Math.sqrt(n*n+i*i)}function constrain(e,t,a){return e<=t?t:e>=a?a:e}function Dialog(e,t,a){this.dialogEl=e,this.overlayEl=t,this.dialogToggler=a,this.focusedElBeforeOpen;var o=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');this.focusableEls=Array.prototype.slice.call(o),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1],this.close()}function createCookie(e,t,a){if(a){var o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3);var n="; expires="+o.toGMTString()}else n="";document.cookie=e+"="+t+n+"; path=/; SameSite=Lax"}function readCookie(e){for(var t=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var n=a[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}Dialog.prototype.open=function(){var e=this;this.dialogEl.classList.add("active"),this.dialogToggler&&this.dialogToggler.classList.add("toggled-on"),this.overlayEl&&this.overlayEl.classList.add("active"),this.focusedElBeforeOpen=document.activeElement,this.dialogEl.addEventListener("keydown",(function(t){e._handleKeyDown(t)})),this.overlayEl&&this.overlayEl.addEventListener("click",(function(){e.close()})),this.firstFocusableEl.focus()},Dialog.prototype.close=function(){currentId=this.dialogEl.id,currentEl=document.getElementById(currentId),currentEl.classList.remove("active"),this.overlayEl&&(this.overlayEl.classList.remove("active"),this.dialogToggler.classList.remove("toggled-on")),this.focusedElBeforeOpen&&this.focusedElBeforeOpen.focus()},Dialog.prototype._handleKeyDown=function(e){var t=this;switch(e.keyCode){case 9:if(1===t.focusableEls.length){e.preventDefault();break}e.shiftKey?function handleBackwardTab(){document.activeElement===t.firstFocusableEl&&(e.preventDefault(),t.lastFocusableEl.focus())}():function handleForwardTab(){document.activeElement===t.lastFocusableEl&&(e.preventDefault(),t.firstFocusableEl.focus())}();break;case 27:t.close()}},Dialog.prototype.addEventListeners=function(e,t){for(var a=this,o=document.querySelectorAll(e),n=0;n<o.length;n++)o[n].addEventListener("click",(function(){a.open()}));if(t){var i=document.querySelectorAll(t);for(n=0;n<i.length;n++)i[n].addEventListener("click",(function(){a.close()}))}},jQuery(document).ready((function(e){e("#page").css("display","block"),e("#pageload-spinner").hide();var t=e("#toolbar-buttons-table input"),a=[],o=manducaVariables.reading_options;e.each(t,(function(t,o){var n=e(o).attr("class");n=n.replace("toggle-checkbox ",""),-1===e.inArray(n,a)&&a.push(n)})),e.each(a,(function(t,a){var n="#checkbox-"+a,i=readCookie(a);if(i){"1"===i.slice(-1)&&e(n).prop("checked","true"),e("html").addClass(i)}else{if(void 0===o[a])var l=a+"-0";else{l=a+"-"+o[a];e("."+a).removeAttr("disabled")}e("html").addClass(l)}e(n).change((function(){e(this).is(":checked")?$id=a+"-1":$id=a+"-0";var t="";for($i=0;$i<2;$i++){var o=a+"-"+$i+" ";t=t.concat(o)}var n=new Date;e("html").removeClass(t),e("html").addClass($id),n.setFullYear(n.getFullYear()+10),document.cookie=a+"="+$id+"; expires="+n.toGMTString()+"; path=/"}))}));var n,i;e("html").hasClass("animation-0");e(".target").on("click",(function(){location.reload()})),(n=e(".megamenu-parent")).find(".menu-toggle"),n.find(".megamenu"),i=n.find(".megamenu > ul"),new Dialog(document.querySelector(".megamenu"),document.querySelector(".dialog-overlay"),document.querySelector(".menu-toggle")).addEventListeners(".menu-toggle",".modal-window-close"),function touchDevice(){function getSubNavObj(t){var a=t.attr("id").replace("button","sub-nav");return e("#"+a)}function toggleFocusClassTouchScreen(){"none"===e(".menu-toggle").css("display")?(e(document.body).on("touchstart.manduca",(function(t){e(t.target).closest(".main-navigation li").length||e(".main-navigation li").removeClass("focus")})),i.find(".menu-item-has-children > a, .page_item_has_children > a").on("touchstart.manduca",(function(t){var a=e(this).parent("li");a.hasClass("focus")||(t.preventDefault(),a.toggleClass("focus"),a.siblings(".focus").removeClass("focus"))}))):i.find(".menu-item-has-children > a, .page_item_has_children > a").unbind("touchstart.manduca")}i.length&&i.children().length&&(!function initMainNavigation(t){t.find(".dropdown-toggle").click((function(t){var a=e(this);t.preventDefault();var o=getSubNavObj(a);if(a.hasClass("toggled-on"))a.removeClass("toggled-on"),a.attr("aria-expanded",!1),o.removeClass("active");else{var n;for(let e=0;e<3&&(n="level-"+e,!a.hasClass(n));e++);var i=e(".dropdown-toggle."+n);e.each(i,(function(t,a){($element=e(a),$element.hasClass("toggled-on"))&&($element.removeClass("toggled-on"),getSubNavObj($element).removeClass("active"))})),a.addClass("toggled-on"),o.addClass("active"),a.attr("aria-expanded","true")}}))}(e(".main-navigation")),"ontouchstart"in window&&(e(window).on("resize.manduca",toggleFocusClassTouchScreen),toggleFocusClassTouchScreen()),i.find("a").on("focus.manduca blur.manduca",(function(){e(this).parents(".menu-item, .page_item").toggleClass("focus")})),e(".main-navigation").keyup((function(t){var a=t.keyCode||t.which;if(9===a||27===a){var o,n=e(":focus");levelInt=-1;for(let e=0;e<3&&(levelInt=e,o="level-"+e,levelParent="level-"+(e-1),!n.hasClass(o));e++);var i=e(".dropdown-toggle.toggled-on."+levelParent),l=e(".dropdown-toggle.toggled-on"),s=e(".sub-nav.active."+levelParent),r=e(".sub-nav.active");if(9===a&&(0==levelInt&&(l.removeClass("toggled-on"),r.removeClass("active")),n.hasClass("menu-link")&&levelInt!==l.length)){var d="level-"+(levelInt+1);console.log("bez√°r a "+d),e(".dropdown-toggle.toggled-on."+o).removeClass("toggled-on"),e(".sub-nav.active."+o).removeClass("active")}27===a&&(i.removeClass("toggled-on"),i.focus(),s.removeClass("active"))}})))}(),e("#manduca-back-to-top").click((function(e){return e.preventDefault(),jQuery("html, body").animate({scrollTop:0},800),jQuery("#menu-toggle").focus(),!1})),e("#skip-to-content").click((function(e){e.preventDefault();var t=jQuery("#primary").position(),a=parseInt(t.top);return jQuery("html, body").animate({scrollTop:a},800),jQuery("#content").find("h1").first().attr("tabindex","0").focus(),!1})),e(document).on("scroll",(function(t){return t.preventDefault(),e(window).scrollTop()>100?e(".manduca-back-to-top-div").addClass("show"):e(".manduca-back-to-top-div").removeClass("show"),!1})),e("a").click((function(){var t=e("html").hasClass("link-target-2");e("html").hasClass("link-target-1")&&e(this).attr("target","_self"),t&&e(this).attr("target","_blank")})),e("#manduca_archive-month-submit").click((function(){var t=e("#manduca-archive-year-dropdown").val(),a=e("#manduca-archive-month-dropdown").val(),o=window.location.protocol+"//"+window.location.host+"/"+t+"/"+a+"/";document.location.href=o})),e("#manduca-archive-year-dropdown").change((function(){var t=e("#manduca-archive-year-dropdown").val(),a=window.location.protocol+"//"+window.location.host+"/?manduca=ajax";jQuery.ajax({url:a,type:"post",data:{action:"archives",year:t,hash:manducaVariables.hash},success:function(t){e("#manduca-archive-month-dropdown option").remove(),e("#manduca-archive-month-dropdown").append(t).focus()}})}));var l="data-controls",s="aria-expanded",r="data-hidden",d=e(".js-expandmore"),c=e("#wrapper"),u=window.location.hash.replace("#","");d.length&&d.each((function(t){var a=e(this),o=t+1,n=a.data(),i=void 0!==n.hideshowPrefixClass?n.hideshowPrefixClass+"-":"",d=void 0!==n.notAllExpands,c=a.next(".js-to_expand"),f=a.html();a.html('<button type="button" class="'+i+'expandmore__button js-expandmore-button"'+(d?'data-not-all-expands="true"':"")+'><span class="'+i+'expandmore__symbol" aria-hidden="true"></span>'+f+"</button>");var p=a.children(".js-expandmore-button");c.addClass(i+"expandmore__to_expand").stop().delay(1500).queue((function(){var t=e(this);t.hasClass("js-first_load")&&t.removeClass("js-first_load")})),p.attr("id","label_expand_"+o),p.attr(l,"expand_"+o),p.attr(s,"false"),c.attr("id","expand_"+o),c.attr(r,"true"),c.attr("data-labelledby","label_expand_"+o),d&&c.attr("data-not-all-expands","true"),(c.hasClass("is-opened")||""!==u&&c.find(e("#"+u)).length)&&(p.addClass("is-opened").attr(s,"true"),c.removeClass("is-opened").removeAttr(r))})),c.on("click",".js-expandmore-button",(function(t){var a=e(this),o=e("#"+a.attr(l));"false"===a.attr(s)?(a.addClass("is-opened").attr(s,"true"),o.removeAttr(r)):(a.removeClass("is-opened").attr(s,"false"),o.attr(r,"true")),t.preventDefault()})),c.on("keydown",".js-expandmore-button",(function(t){var a=e(this),o=e("#"+a.attr(l));27===t.keyCode&&"true"===a.attr(s)&&(a.removeClass("is-opened").attr(s,"false"),o.attr(r,"true"),a.focus())})),c.on("click keydown",".js-expandmore",(function(t){var a=e(this),o=e(t.target),n=a.find(".js-expandmore-button");if(!o.is(n)&&!o.closest(n).length){if("click"===t.type)return n.trigger("click"),!1;if("keydown"===t.type&&(13===t.keyCode||32===t.keyCode))return n.trigger("click"),!1}})),c.on("click keydown",".js-expandmore-all",(function(t){var a=e(this),o=a.data(),n=a.attr("data-expand"),i=void 0!==o.textExpandAll?o.textExpandAll:manducaVariables.expand_all,l=void 0!==o.textCloseAll?o.textCloseAll:manducaVariables.collapse_all,d=e(".js-expandmore-button:not([data-not-all-expands])"),c=e(".js-to_expand:not([data-not-all-expands])");"click"!==t.type&&("keydown"!==t.type||13!==t.keyCode&&32!==t.keyCode)||("true"===n?(d.addClass("is-opened").attr(s,"true"),c.removeAttr(r),a.attr("data-expand","false").html(l)):(d.removeClass("is-opened").attr(s,"false"),c.attr(r,"true"),a.attr("data-expand","true").html(i)))})),new Dialog(document.querySelector(".toolbar-buttons"),document.querySelector(".dialog-overlay"),document.querySelector(".toolbar-buttons-open")).addEventListeners(".toolbar-buttons-open",".modal-window-close")})),function otherFunctions(){function accessibleSimpleTooltipAria(e){var t=jQuery(this),a=(e=e||t.data()).simpletooltipText||"",o=void 0!==e.simpletooltipPrefixClass?e.simpletooltipPrefixClass+"-":"",n=void 0!==e.simpletooltipContentId?"#"+e.simpletooltipContentId:"",i=Math.random().toString(32).slice(2,12),l=t.attr("aria-describedby")||"";t.attr({"aria-describedby":("label_simpletooltip_"+i+" "+l).trim()}),t.wrap('<span class="'+o+'simpletooltip_container"></span>');var s='<span class="js-simpletooltip '+o+'simpletooltip" id="label_simpletooltip_'+i+'" role="tooltip" aria-hidden="true">';if(""!==a)s+=""+a;else{var r=jQuery(n);""!==n&&r.length&&(s+=r.html())}s+="</span>",jQuery(s).insertAfter(t)}jQuery(document).ready((function(e){e.fn.accessibleSimpleTooltipAria=accessibleSimpleTooltipAria,e(".js-simple-tooltip").each((function(){accessibleSimpleTooltipAria.apply(this)})),e("body").on("mouseenter focusin",".js-simple-tooltip",(function(){var t=e(this).attr("aria-describedby").trimEnd(" "),a=e("#"+t);a.attr("aria-hidden","false"),a.addClass("tooltip-show")})).on("mouseleave",".js-simple-tooltip",(function(t){var a=e(this).attr("aria-describedby").trimEnd(" "),o=e("#"+a);o.is(":hover")||(o.attr("aria-hidden","true"),o.removeClass("tooltip-show"))})).on("focusout",".js-simple-tooltip",(function(t){var a=e(this).attr("aria-describedby").trimEnd(" "),o=e("#"+a);o.attr("aria-hidden","true"),o.removeClass("tooltip-show")})).on("mouseleave",".js-simple-tooltip",(function(){var t=e(this);t.attr("aria-hidden","true");var a=t.attr("aria-describedby").trimEnd(" ");e("#"+a).removeClass("tooltip-show")})).on("keydown",".js-simple-tooltip",(function(t){var a=e(this).attr("aria-describedby").trimEnd(" "),o=e("#"+a);27==t.keyCode&&(o.attr("aria-hidden","true"),o.removeClass("tooltip-show"))}))}))}();