/*  This file is part of WordPress theme named Manduca - focus on accessibility.
 *
	Copyright (C) 2015-2019 Zsolt Edel√©nyi (ezs@web25.hu)

    Manduca is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    in /assets/docs/licence.txt.  If not, see <https://www.gnu.org/licenses/>.
*/

jQuery.noConflict(),function(){var e=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,t=navigator.userAgent.toLowerCase().indexOf("opera")>-1,o=navigator.userAgent.toLowerCase().indexOf("msie")>-1;(e||t||o)&&document.getElementById&&window.addEventListener&&window.addEventListener("hashchange",function(){var e,t=location.hash.substring(1);/^[A-z0-9_-]+$/.test(t)&&(e=document.getElementById(t))&&(/^(?:a|select|input|button|textarea)$/i.test(e.tagName)||(e.tabIndex=-1),e.focus(),window.scrollBy(0,-53))},!1)}();var OFFSET_PX=0,MIN_WIDTH=12,MIN_HEIGHT=8,START_FRACTION=.4,MIDDLE_FRACTION=.8,focusSnail={enabled:!0,trigger:trigger};function trigger(e,t){svg?onEnd():initialize();var o=dimensionsOf(e),n=dimensionsOf(t),s=0,a=0,i=0,r=0,d=animationDuration(dist(o.left,o.top,n.left,n.top));var u=!0;animate(function(e){var t;u&&(t=scrollOffset(),svg.style.left=t.left+"px",svg.style.top=t.top+"px",svg.setAttribute("width",win.innerWidth),svg.setAttribute("height",win.innerHeight),svg.classList.add("focus-snail_visible"),s=n.left-t.left,a=o.left-t.left,i=n.top-t.top,r=o.top-t.top,setGradientAngle(gradient,a,r,o.width,o.height,s,i,n.width,n.height),enclose(getPointsList({top:r,right:a+o.width,bottom:r+o.height,left:a},{top:i,right:s+n.width,bottom:i+n.height,left:s}),polygon));var d=e>START_FRACTION?easeOutQuad((e-START_FRACTION)/(1-START_FRACTION)):0,l=e<MIDDLE_FRACTION?easeOutQuad(e/MIDDLE_FRACTION):1;start.setAttribute("offset",100*d+"%"),middle.setAttribute("offset",100*l+"%"),e>=1&&onEnd(),u=!1},d)}function animationDuration(e){return 50*Math.pow(constrain(e,32,1024),1/3)}function easeOutQuad(e){return 2*e-e*e}var win=window,doc=document,docElement=doc.documentElement,body=doc.body,prevFocused=null,animationId=0,keyDownTime=0;function setGradientAngle(e,t,o,n,s,a,i,r,d){var u=rectCentroid(t,o,n,s),l=rectCentroid(a,i,r,d),h=angleToLine(Math.atan2(u.y-l.y,u.x-l.x));e.setAttribute("x1",h.x1),e.setAttribute("y1",h.y1),e.setAttribute("x2",h.x2),e.setAttribute("y2",h.y2)}function rectCentroid(e,t,o,n){return{x:e+o/2,y:t+n/2}}function angleToLine(e){var t=Math.floor(e/Math.PI*2)+2,o=Math.PI/4+Math.PI/2*t,n=Math.sqrt(2),s=Math.cos(Math.abs(o-e))*n,a=s*Math.cos(e),i=s*Math.sin(e);return{x1:a<0?1:0,y1:i<0?1:0,x2:a>=0?a:a+1,y2:i>=0?i:i+1}}docElement.addEventListener("keydown",function(e){if(focusSnail.enabled){var t=e.which;(9===t||t>36&&t<41)&&(keyDownTime=Date.now())}},!1),docElement.addEventListener("blur",function(e){focusSnail.enabled&&(onEnd(),prevFocused=isJustPressed()?e.target:null)},!0),docElement.addEventListener("focus",function(e){prevFocused&&isJustPressed()&&trigger(prevFocused,e.target)},!0);var svg=null,polygon=null,start=null,middle=null,end=null,gradient=null;function htmlFragment(){var e=doc.createElement("div");return e.innerHTML='<svg id="focus-snail_svg" width="1000" height="800">\t\t<linearGradient id="focus-snail_gradient">\t\t\t<stop id="focus-snail_start" offset="0%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0"/>\t\t\t<stop id="focus-snail_middle" offset="80%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0.8"/>\t\t\t<stop id="focus-snail_end" offset="100%" stop-color="rgb('+manducaVariables.red+", "+manducaVariables.green+", "+manducaVariables.blue+')" stop-opacity="0"/>\t\t</linearGradient>\t\t<polygon id="focus-snail_polygon" fill="url(#focus-snail_gradient)"/>\t</svg>',e}function initialize(){var e=htmlFragment();svg=getId(e,"svg"),polygon=getId(e,"polygon"),start=getId(e,"start"),middle=getId(e,"middle"),end=getId(e,"end"),gradient=getId(e,"gradient"),body.appendChild(svg)}function getId(e,t){return e.querySelector("#focus-snail_"+t)}function onEnd(){animationId&&(cancelAnimationFrame(animationId),animationId=0,svg.classList.remove("focus-snail_visible"))}function isJustPressed(){return Date.now()-keyDownTime<42}function animate(e,t){var o=Date.now();!function n(){animationId=requestAnimationFrame(function(){var s=Date.now()-o;e(s/t),s<t&&n()})}()}function getPointsList(e,t){var o=0;e.top<t.top&&(o=1),e.right>t.right&&(o+=2),e.bottom>t.bottom&&(o+=4),e.left<t.left&&(o+=8);for(var n=rectPoints(e).concat(rectPoints(t)),s=[],a=[[],[0,1],[1,2],[0,1,2],[2,3],[0,1],[1,2,3],[0,1,2,3],[3,0],[3,0,1],[3,0],[3,0,1,2],[2,3,0],[2,3,0,1],[1,2,3,0],[0,1,2,3,0]][o],i=0;i<a.length;i++)s.push(n[a[i]]);for(;i--;)s.push(n[a[i]+4]);return s}function enclose(e,t){t.points.clear();for(var o=0;o<e.length;o++){addPoint(t,e[o])}}function addPoint(e,t){var o=e.ownerSVGElement.createSVGPoint();o.x=t.x,o.y=t.y,e.points.appendItem(o)}function rectPoints(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom},{x:e.left,y:e.bottom}]}function dimensionsOf(e){var t=offsetOf(e);return{left:t.left-OFFSET_PX,top:t.top-OFFSET_PX,width:Math.max(MIN_WIDTH,e.offsetWidth)+2*OFFSET_PX,height:Math.max(MIN_HEIGHT,e.offsetHeight)+2*OFFSET_PX}}function offsetOf(e){var t=e.getBoundingClientRect(),o=scrollOffset(),n=docElement.clientTop||body.clientTop,s=docElement.clientLeft||body.clientLeft;return{top:t.top+o.top-n||0,left:t.left+o.left-s||0}}function scrollOffset(){return{top:win.pageYOffset||docElement.scrollTop||0,left:win.pageXOffset||docElement.scrollLeft||0}}function dist(e,t,o,n){var s=e-o,a=t-n;return Math.sqrt(s*s+a*a)}function constrain(e,t,o){return e<=t?t:e>=o?o:e}function createCookie(e,t,o){if(o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var s="; expires="+n.toGMTString()}else s="";document.cookie=e+"="+t+s+"; path=/"}function readCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var s=o[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}!function(e){var t,o,n,s,a,i;t=e(".megamenu-parent"),o=t.find(".menu-toggle"),n=t.find(".megamenu"),s=t.find(".megamenu > ul"),a=e(".toolbar-buttons"),i=e(".toolbar-buttons-open"),o.length&&(o.attr("aria-expanded","false"),o.on("click.manduca",function(){n.toggleClass("toggled-on"),o.toggleClass("toggled-on"),i.removeClass("toggled-on"),i.attr("aria-expanded","false"),a.removeClass("toggled-on"),a.css("display","none"),e(this).attr("aria-expanded",n.hasClass("toggled-on"))})),function(){var t,o;s.length&&s.children().length&&(t=e(".main-navigation"),o=e("<button />",{class:"dropdown-toggle","aria-expanded":!1}).append(manducaVariables.icon).append(e("<span />",{class:"screen-reader-text",text:manducaVariables.expand})),t.find(".menu-item-has-children > a, .page_item_has_children > a").after(o),t.find(".dropdown-toggle").click(function(t){var o=e(this),n=o.find(".screen-reader-text");t.preventDefault(),o.toggleClass("toggled-on"),o.next(".children, .sub-nav").toggleClass("toggled-on"),o.attr("aria-expanded","false"===o.attr("aria-expanded")?"true":"false"),n.text(n.text()===manducaVariables.expand?manducaScreenReaderText.collapse:manducaScreenReaderText.expand)}),"ontouchstart"in window&&(e(window).on("resize.manduca",n),n()),s.find("a").on("focus.manduca blur.manduca",function(){e(this).parents(".menu-item, .page_item").toggleClass("focus")}));function n(){"none"===e(".menu-toggle").css("display")?(e(document.body).on("touchstart.manduca",function(t){e(t.target).closest(".main-navigation li").length||e(".main-navigation li").removeClass("focus")}),s.find(".menu-item-has-children > a, .page_item_has_children > a").on("touchstart.manduca",function(t){var o=e(this).parent("li");o.hasClass("focus")||(t.preventDefault(),o.toggleClass("focus"),o.siblings(".focus").removeClass("focus"))})):s.find(".menu-item-has-children > a, .page_item_has_children > a").unbind("touchstart.manduca")}}();var r=readCookie("contrastType");r?(e("body").addClass(r),e("#"+r).attr("disabled","true")):(e("body").addClass("high-contrast-0"),e("#high-contrast-0").attr("disabled","true"));var d=readCookie("fontType");d?(e("body").addClass(d),e("#"+d).attr("disabled","true")):(e("body").addClass("font-type-0"),e("#font-type-0").attr("disabled","true"));var u=readCookie("fontSize");u?(e("body").addClass(u),e("#"+u).attr("disabled","true")):(e("body").addClass("font-size-0"),e("#font-size-0").attr("disabled","true"));var l=readCookie("linkTarget");l?e("#target-"+l).attr("disabled","true"):e("#target-default").attr("disabled","true"),e(".toolbar-buttons-open").click(function(){e(".toolbar-buttons").slideToggle(200),e(".menu-toggle").hasClass("toggled-on")&&(e(".megamenu").removeClass("toggled-on"),e(".menu-toggle").removeClass("toggled-on")),e(".toolbar-buttons").hasClass("toggled-on")?(e(".toolbar-buttons").removeClass("toggled-on"),e(".toolbar-buttons-open").removeClass("toggled-on"),e(".toolbar-buttons-open").attr("aria-expanded","false"),e("#toolbar-buttons-open").focus()):(e(".toolbar-buttons").addClass("toggled-on"),e(".toolbar-buttons-open").addClass("toggled-on"),e(".toolbar-buttons-open").attr("aria-expanded","true"))}),e("#buttons-close").click(function(){e("#toolbar-buttons").slideUp(),e(".toolbar-buttons-open").removeClass("toggled-on"),e(".toolbar-buttons").removeClass("toggled-on"),e(".toolbar-buttons-open").attr("aria-expanded","false"),e("#toolbar-buttons-open").focus()}),e(document).on("keyup",function(t){"Escape"===t.key&&e(".toolbar-buttons").hasClass("toggled-on")&&(e(".toolbar-buttons").removeClass("toggled-on"),e(".toolbar-buttons-open").removeClass("toggled-on"),e(".toolbar-buttons-open").attr("aria-expanded","false"),e(".toolbar-buttons").css("display","none"),e("#toolbar-buttons-open").focus())}),e(".change-font-size").click(function(){var t=e(this).attr("data-zoom");e(".change-font-size").removeAttr("disabled"),e(this).attr("disabled","true");var o=new Date;e("body").removeClass("font-size-0 font-size-1 font-size-2 font-size-3"),e("body").addClass(t),o.setFullYear(o.getFullYear()+10),document.cookie="fontSize="+t+"; expires="+o.toGMTString()+"; path=/"}),e(".high-contrast").click(function(){var t=e(this).attr("data-contrast-type");e(".high-contrast").removeAttr("disabled"),e(this).attr("disabled","true");var o=new Date;e("body").removeClass("high-contrast-1 high-contrast-2 high-contrast-3 high-contrast-0"),e("body").addClass(t),o.setFullYear(o.getFullYear()+10),document.cookie="contrastType="+t+"; expires="+o.toGMTString()+"; path=/"}),e(".change-font-type").click(function(){var t=e(this).attr("data-font-type");e(".change-font-type").removeAttr("disabled"),e(this).attr("disabled","true");var o=new Date;e("body").removeClass("font-type-1 font-type-2 font-type-0"),e("body").addClass(t),o.setFullYear(o.getFullYear()+10),document.cookie="fontType="+t+"; expires="+o.toGMTString()+"; path=/"}),e(".target-selector").on("click",function(){var t=e(this).attr("data-target");e(".target-selector").removeAttr("disabled"),e(this).attr("disabled","true");var o=new Date;o.setFullYear(o.getFullYear()+10),document.cookie="linkTarget="+t+"; expires="+o.toGMTString()+"; path=/",location.reload()}),e("#skip-to-content").click(function(e){e.preventDefault();var t=jQuery("#primary").position(),o=parseInt(t.top);return jQuery("html, body").animate({scrollTop:o},800),jQuery("#primary").find("h1").first().focus(),!1}),e("#skip-to-sidebar").click(function(e){e.preventDefault();var t=jQuery("#secondary").position(),o=parseInt(t.top);return jQuery("html, body").animate({scrollTop:o},800),jQuery("#secondary").find("h1").first().focus(),!1}),e("#skip-to-footer").click(function(e){e.preventDefault();var t=jQuery("#footer-wrapper").position(),o=parseInt(t.top);return jQuery("html, body").animate({scrollTop:o},800),jQuery("#footer-wrapper").find("h1").first().focus(),!1}),e("#manduca-back-to-top").click(function(e){return e.preventDefault(),jQuery("html, body").animate({scrollTop:0},800),jQuery("#menu-toggle").focus(),!1}),e(document).on("scroll",function(t){return t.preventDefault(),e(window).scrollTop()>100?e(".manduca-back-to-top-div").addClass("show"):e(".manduca-back-to-top-div").removeClass("show"),!1}),e("a.extlink").click(function(){var t=readCookie("linkTarget");"self"==t&&e(this).attr("target","_self"),"blank"==t&&e(this).attr("target","_blank")}),e("#manduca_archive-month-submit").click(function(){var t=e("#manduca-archive-year-dropdown").val(),o=e("#manduca-archive-month-dropdown").val(),n=window.location.protocol+"//"+window.location.host+"/"+t+"/"+o+"/";document.location.href=n}),e("#manduca-archive-year-dropdown").change(function(){var t=e("#manduca-archive-year-dropdown").val(),o=window.location.protocol+"//"+window.location.host+"/?manduca=ajax";jQuery.ajax({url:o,type:"post",data:{action:"archives",year:t,hash:manducaVariables.hash},success:function(t){e("#manduca-archive-month-dropdown option").remove(),e("#manduca-archive-month-dropdown").append(t).focus()}})})}(jQuery),jQuery(document).ready(function(e){var t=e(".js-expandmore"),o=e("#wrapper"),n=window.location.hash.replace("#","");t.length&&t.each(function(t){var o=e(this),s=t+1,a=o.data(),i=void 0!==a.hideshowPrefixClass?a.hideshowPrefixClass+"-":"",r=void 0!==a.notAllExpands,d=o.next(".js-to_expand"),u=o.html();o.html('<button type="button" class="'+i+'expandmore__button js-expandmore-button"'+(r?'data-not-all-expands="true"':"")+'><span class="'+i+'expandmore__symbol" aria-hidden="true"></span>'+u+"</button>");var l=o.children(".js-expandmore-button");d.addClass(i+"expandmore__to_expand").stop().delay(1500).queue(function(){var t=e(this);t.hasClass("js-first_load")&&t.removeClass("js-first_load")}),l.attr("id","label_expand_"+s),l.attr("data-controls","expand_"+s),l.attr("aria-expanded","false"),d.attr("id","expand_"+s),d.attr("data-hidden","true"),d.attr("data-labelledby","label_expand_"+s),r&&d.attr("data-not-all-expands","true"),(d.hasClass("is-opened")||""!==n&&d.find(e("#"+n)).length)&&(l.addClass("is-opened").attr("aria-expanded","true"),d.removeClass("is-opened").removeAttr("data-hidden"))}),o.on("click",".js-expandmore-button",function(t){var o=e(this),n=e("#"+o.attr("data-controls"));"false"===o.attr("aria-expanded")?(o.addClass("is-opened").attr("aria-expanded","true"),n.removeAttr("data-hidden")):(o.removeClass("is-opened").attr("aria-expanded","false"),n.attr("data-hidden","true")),t.preventDefault()}),o.on("keydown",".js-expandmore-button",function(t){var o=e(this),n=e("#"+o.attr("data-controls"));27===t.keyCode&&"true"===o.attr("aria-expanded")&&(o.removeClass("is-opened").attr("aria-expanded","false"),n.attr("data-hidden","true"),o.focus())}),o.on("click keydown",".js-expandmore",function(t){var o=e(this),n=e(t.target),s=o.find(".js-expandmore-button");if(!n.is(s)&&!n.closest(s).length){if("click"===t.type)return s.trigger("click"),!1;if("keydown"===t.type&&(13===t.keyCode||32===t.keyCode))return s.trigger("click"),!1}}),o.on("click keydown",".js-expandmore-all",function(t){var o=e(this),n=o.data(),s=o.attr("data-expand"),a=void 0!==n.textExpandAll?n.textExpandAll:manducaVariables.expand_all,i=void 0!==n.textCloseAll?n.textCloseAll:manducaVariables.collapse_all,r=e(".js-expandmore-button:not([data-not-all-expands])"),d=e(".js-to_expand:not([data-not-all-expands])");"click"!==t.type&&("keydown"!==t.type||13!==t.keyCode&&32!==t.keyCode)||("true"===s?(r.addClass("is-opened").attr("aria-expanded","true"),d.removeAttr("data-hidden"),o.attr("data-expand","false").html(i)):(r.removeClass("is-opened").attr("aria-expanded","false"),d.attr("data-hidden","true"),o.attr("data-expand","true").html(a)))})});var MenubarItem=function(e,t){this.menu=t,this.domNode=e,this.popupMenu=!1,this.hasFocus=!1,this.hasHover=!1,this.isMenubarItem=!0,this.keyCode=Object.freeze({TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40})};MenubarItem.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this));var e=this.domNode.nextElementSibling;e&&"UL"===e.tagName&&(this.popupMenu=new PopupMenu(e,this),this.popupMenu.init())},MenubarItem.prototype.handleKeydown=function(e){e.currentTarget;var t,o=e.key,n=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:case this.keyCode.DOWN:this.popupMenu&&(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem(),n=!0);break;case this.keyCode.LEFT:this.menu.setFocusToPreviousItem(this),n=!0;break;case this.keyCode.RIGHT:this.menu.setFocusToNextItem(this),n=!0;break;case this.keyCode.UP:this.popupMenu&&(this.popupMenu.open(),this.popupMenu.setFocusToLastItem(),n=!0);break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.menu.setFocusToFirstItem(),n=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.menu.setFocusToLastItem(),n=!0;break;case this.keyCode.TAB:case this.keyCode.ESC:this.popupMenu.close(!0);break;default:1===(t=o).length&&t.match(/\S/)&&(this.menu.setFocusByFirstCharacter(this,o),n=!0)}n&&(e.stopPropagation(),e.preventDefault())},MenubarItem.prototype.setExpanded=function(e){e?this.domNode.setAttribute("aria-expanded","true"):this.domNode.setAttribute("aria-expanded","false")},MenubarItem.prototype.handleFocus=function(e){this.menu.hasFocus=!0},MenubarItem.prototype.handleBlur=function(e){this.menu.hasFocus=!1},MenubarItem.prototype.handleMouseover=function(e){this.hasHover=!0,this.popupMenu.open()},MenubarItem.prototype.handleMouseout=function(e){this.hasHover=!1,setTimeout(this.popupMenu.close.bind(this.popupMenu,!1),300)};var Menubar=function(t){var o="Menubar constructor argument menubarNode ";if(!t instanceof Element)throw new TypeError(o+"is not a DOM Element.");if(0===t.childElementCount)throw new Error(o+"has no element children.");for(e=t.firstElementChild;e;){var n=e.firstElementChild;if(e&&n&&"A"!==n.tagName)throw new Error(o+"has child elements are not A elements.");e=e.nextElementSibling}this.isMenubar=!0,this.domNode=t,this.menubarItems=[],this.firstChars=[],this.firstItem=null,this.lastItem=null,this.hasFocus=!1,this.hasHover=!1};Menubar.prototype.init=function(){var e,t,o;for(elem=this.domNode.firstElementChild;elem;){var n=elem.firstElementChild;elem&&n&&"A"===n.tagName&&((e=new MenubarItem(n,this)).init(),this.menubarItems.push(e),t=n.textContent.trim(),this.firstChars.push(t.substring(0,1).toLowerCase())),elem=elem.nextElementSibling}(o=this.menubarItems.length)>0&&(this.firstItem=this.menubarItems[0],this.lastItem=this.menubarItems[o-1]),this.firstItem.domNode.tabIndex=0},Menubar.prototype.setFocusToItem=function(e){for(var t=!1,o=0;o<this.menubarItems.length;o++){var n=this.menubarItems[o];0==n.domNode.tabIndex&&(t="true"===n.domNode.getAttribute("aria-expanded")),n.domNode.tabIndex=-1,n.popupMenu&&n.popupMenu.close()}e.domNode.focus(),e.domNode.tabIndex=0,t&&e.popupMenu&&e.popupMenu.open()},Menubar.prototype.setFocusToFirstItem=function(e){this.setFocusToItem(this.firstItem)},Menubar.prototype.setFocusToLastItem=function(e){this.setFocusToItem(this.lastItem)},Menubar.prototype.setFocusToPreviousItem=function(e){var t;e===this.firstItem?newItem=this.lastItem:(t=this.menubarItems.indexOf(e),newItem=this.menubarItems[t-1]),this.setFocusToItem(newItem)},Menubar.prototype.setFocusToNextItem=function(e){var t;e===this.lastItem?newItem=this.firstItem:(t=this.menubarItems.indexOf(e),newItem=this.menubarItems[t+1]),this.setFocusToItem(newItem)},Menubar.prototype.setFocusByFirstCharacter=function(e,t){var o,n;t=t.toLowerCase(),e.domNode.getAttribute("aria-expanded");(o=this.menubarItems.indexOf(e)+1)===this.menubarItems.length&&(o=0),-1===(n=this.getIndexFirstChars(o,t))&&(n=this.getIndexFirstChars(0,t)),n>-1&&this.setFocusToItem(this.menubarItems[n])},Menubar.prototype.getIndexFirstChars=function(e,t){for(var o=e;o<this.firstChars.length;o++)if(t===this.firstChars[o])return o;return-1};var MenuItem=function(e,t){"object"!=typeof popupObj&&(popupObj=!1),this.domNode=e,this.menu=t,this.popupMenu=!1,this.isMenubarItem=!1,this.keyCode=Object.freeze({TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40})};MenuItem.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this));var e=this.domNode.nextElementSibling;e&&"UL"===e.tagName&&(this.popupMenu=new PopupMenu(e,this),this.popupMenu.init())},MenuItem.prototype.isExpanded=function(){return"true"===this.domNode.getAttribute("aria-expanded")},MenuItem.prototype.handleKeydown=function(e){var t,o,n=e.currentTarget,s=e.key,a=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:if(this.popupMenu)this.popupMenu.open(),this.popupMenu.setFocusToFirstItem();else{try{t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(e){document.createEvent&&(t=document.createEvent("MouseEvents")).initEvent("click",!0,!0)}n.dispatchEvent(t)}a=!0;break;case this.keyCode.UP:this.menu.setFocusToPreviousItem(this),a=!0;break;case this.keyCode.DOWN:this.menu.setFocusToNextItem(this),a=!0;break;case this.keyCode.LEFT:this.menu.setFocusToController("previous",!0),this.menu.close(!0),a=!0;break;case this.keyCode.RIGHT:this.popupMenu?(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem()):(this.menu.setFocusToController("next",!0),this.menu.close(!0)),a=!0;break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.menu.setFocusToFirstItem(),a=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.menu.setFocusToLastItem(),a=!0;break;case this.keyCode.ESC:this.menu.setFocusToController(),this.menu.close(!0),a=!0;break;case this.keyCode.TAB:this.menu.setFocusToController();break;default:1===(o=s).length&&o.match(/\S/)&&(this.menu.setFocusByFirstCharacter(this,s),a=!0)}a&&(e.stopPropagation(),e.preventDefault())},MenuItem.prototype.setExpanded=function(e){e?this.domNode.setAttribute("aria-expanded","true"):this.domNode.setAttribute("aria-expanded","false")},MenuItem.prototype.handleClick=function(e){this.menu.setFocusToController(),this.menu.close(!0)},MenuItem.prototype.handleFocus=function(e){this.menu.hasFocus=!0},MenuItem.prototype.handleBlur=function(e){this.menu.hasFocus=!1,setTimeout(this.menu.close.bind(this.menu,!1),300)},MenuItem.prototype.handleMouseover=function(e){this.menu.hasHover=!0,this.menu.open(),this.popupMenu&&(this.popupMenu.hasHover=!0,this.popupMenu.open())},MenuItem.prototype.handleMouseout=function(e){this.popupMenu&&(this.popupMenu.hasHover=!1,this.popupMenu.close(!0)),this.menu.hasHover=!1,setTimeout(this.menu.close.bind(this.menu,!1),300)};var PopupMenu=function(e,t){var o="PopupMenu constructor argument domNode ";if(!e instanceof Element)throw new TypeError(o+"is not a DOM Element.");if(0===e.childElementCount)throw new Error(o+"has no element children.");for(var n=e.firstElementChild;n;){var s=n.firstElementChild;if(s&&"A"===s)throw new Error(o+"has descendant elements that are not A elements.");n=n.nextElementSibling}this.isMenubar=!1,this.domNode=e,this.controller=t,this.menuitems=[],this.firstChars=[],this.firstItem=null,this.lastItem=null,this.hasFocus=!1,this.hasHover=!1};PopupMenu.prototype.init=function(){var e,t,o,n,s;for(this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this)),e=this.domNode.firstElementChild;e;)(t=e.firstElementChild)&&"A"===t.tagName&&((o=new MenuItem(t,this)).init(),this.menuitems.push(o),n=t.textContent.trim(),this.firstChars.push(n.substring(0,1).toLowerCase())),e=e.nextElementSibling;(s=this.menuitems.length)>0&&(this.firstItem=this.menuitems[0],this.lastItem=this.menuitems[s-1])},PopupMenu.prototype.handleMouseover=function(e){this.hasHover=!0},PopupMenu.prototype.handleMouseout=function(e){this.hasHover=!1,setTimeout(this.close.bind(this,!1),1)},PopupMenu.prototype.setFocusToController=function(e,t){if("string"!=typeof e&&(e=""),""!==e){if(this.controller.isMenubarItem)"previous"===e?this.controller.menu.setFocusToPreviousItem(this.controller,t):"next"===e&&this.controller.menu.setFocusToNextItem(this.controller,t);else if(this.controller.domNode.focus(),this.close(),"next"===e){var o=function(e,t){for(;e;){if(e.isMenubarItem)return e.domNode.focus(),e;t&&e.menu.close(!0),e.hasFocus=!1,e=e.menu.controller}return!1}(this.controller,!1);o&&o.menu.setFocusToNextItem(o,t)}}else this.controller&&this.controller.domNode&&this.controller.domNode.focus()},PopupMenu.prototype.setFocusToFirstItem=function(){this.firstItem.domNode.focus()},PopupMenu.prototype.setFocusToLastItem=function(){this.lastItem.domNode.focus()},PopupMenu.prototype.setFocusToPreviousItem=function(e){var t;e===this.firstItem?this.lastItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t-1].domNode.focus())},PopupMenu.prototype.setFocusToNextItem=function(e){var t;e===this.lastItem?this.firstItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t+1].domNode.focus())},PopupMenu.prototype.setFocusByFirstCharacter=function(e,t){var o,n;t=t.toLowerCase();(o=this.menuitems.indexOf(e)+1)===this.menuitems.length&&(o=0),-1===(n=this.getIndexFirstChars(o,t))&&(n=this.getIndexFirstChars(0,t)),n>-1&&this.menuitems[n].domNode.focus()},PopupMenu.prototype.getIndexFirstChars=function(e,t){for(var o=e;o<this.firstChars.length;o++)if(t===this.firstChars[o])return o;return-1},PopupMenu.prototype.open=function(){var e=this.controller.domNode.getBoundingClientRect();this.controller.isMenubarItem?(this.domNode.style.display="block",this.domNode.style.position="absolute",this.domNode.style.top=e.height-1+"px",this.domNode.style.zIndex=100):(this.domNode.parentNode.style.position="relative",this.domNode.style.display="block",this.domNode.style.position="absolute",this.domNode.style.left=e.width+"px",this.domNode.style.zIndex=100),this.controller.setExpanded(!0)},PopupMenu.prototype.close=function(e){for(var t=this.controller.hasHover,o=this.hasFocus,n=0;n<this.menuitems.length;n++){var s=this.menuitems[n];s.popupMenu&&(o|=s.popupMenu.hasFocus)}this.controller.isMenubarItem||(t=!1),!e&&(o||this.hasHover||t)||(this.domNode.style.display="none",this.domNode.style.zIndex=0,this.controller.setExpanded(!1))};